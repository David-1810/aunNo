<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nuestra Historia</title>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Quicksand&display=swap" rel="stylesheet">
  <style>
    :root {
      --lila: #D7BDE2;
      --lila-oscuro: #BB8FCE;
      --texto: #4A235A;
      --fondo: #FDF3FF;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      background-color: var(--fondo);
      color: var(--texto);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      text-align: center;
    }

    #contenedor {
      max-width: 90%;
      padding: 20px;
      background-color: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(187, 143, 206, 0.3);
      transition: all 0.5s ease-in-out;
    }

    #frase {
      font-size: 1.5em;
      margin-bottom: 30px;
      font-family: 'Dancing Script', cursive;
    }

    .botones {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 15px;
    }

    button {
      background-color: var(--lila);
      color: var(--texto);
      border: none;
      padding: 12px 24px;
      font-size: 1em;
      border-radius: 12px;
      cursor: pointer;
      transition: background-color 0.3s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    button:hover {
      background-color: var(--lila-oscuro);
    }

    textarea {
      margin-top: 15px;
      width: 100%;
      max-width: 400px;
      height: 80px;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid var(--lila-oscuro);
      font-family: 'Quicksand', sans-serif;
      resize: none;
    }

    .corazon {
      position: absolute;
      color: #F1948A;
      font-size: 1.5rem;
      animation: flotar 10s linear infinite;
      opacity: 0.4;
      z-index: 1;
    }

    @keyframes flotar {
      0% { transform: translateY(100vh) scale(1); opacity: 0.4; }
      100% { transform: translateY(-100vh) scale(1.5); opacity: 0; }
    }

    @media (max-width: 600px) {
      #frase { font-size: 1.3em; }
      button { font-size: 0.95em; padding: 10px 20px; }
    }
  </style>
</head>
<body>

<!-- Corazones flotantes -->
<script>
  for (let i = 0; i < 20; i++) {
    const corazon = document.createElement('div');
    corazon.className = 'corazon';
    corazon.style.left = Math.random() * 100 + 'vw';
    corazon.style.fontSize = (1 + Math.random() * 1.5) + 'rem';
    corazon.style.animationDuration = (5 + Math.random() * 10) + 's';
    corazon.innerText = '💖';
    document.body.appendChild(corazon);
  }
</script>

<div id="contenedor">
  <div id="frase">Toca para comenzar nuestra historia... 💖</div>
  <div id="campoRespuesta"></div>
  <div class="botones">
    <button id="btnSiguiente" onclick="mostrarSiguiente()">Siguiente</button>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCIsuPHYYhxQYbz5zTJZyr63xJ100shyoo",
    authDomain: "prueba-5a28c.firebaseapp.com",
    projectId: "prueba-5a28c",
    storageBucket: "prueba-5a28c.firebasestorage.app",
    messagingSenderId: "1003817153957",
    appId: "1:1003817153957:web:aa74e747452f1fe361a44c"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

<script>
  const frases = [
    "Todo empezó con un...",
    "Hola, ¿te gustaría bailar? Para que no piensen que solo vinimos por la comida… 😅",
    "Una pregunta que no sabía que cambiaría mi vida 😏",
    "Con cada charla, me fui sintiendo más afortunado 🍀",
    "Tu voz, tu risa, tu forma de ser… me fueron atrapando 💘",
    "Y no puedo evitar pensar cuánto significas para mí 💭",
    "Eres mi pensamiento favorito, incluso cuando intento concentrarme 😅",
    "Si estoy sonriendo sin razón, probablemente estés tú en mi mente 💞",
    "Desde que llegaste, todo se siente más bonito 🌷",
    "Hay personas que iluminan días... tú iluminas hasta pensamientos 🌟",
    "Te convertiste en mi canción favorita sin siquiera cantar 🎶",
    "Quisiera guardar cada risa tuya en mi bolsillo 🫶",
    "Me haces sentir que hasta los silencios pueden ser mágicos 🌌",
    "Y aquí estoy, dedicándote este pequeño espacio solo para ti 💖",
    "Porque cada palabra, cada gesto, cada momento contigo es un regalo 🎁",
    "¿Qué te parece si seguimos escribiendo nuestra historia juntos? 📖",
    "Porque cada día contigo es una nueva página llena de sorpresas y risas 🌈",
    "Y aunque no siempre sea fácil, sé que contigo todo vale la pena ☺️",
    "Aquí estoy, esperando que este pequeño gesto te haga sonreír 😄",
    "Porque te mereces todo lo bonito que pueda imaginar 💖",
    "Y aunque no siempre encuentre las palabras perfectas, espero que sientas lo que quiero decirte 💌",
    "Si alguna vez te has sentido especial, es porque lo eres para mí 🌟",
    "¿Qué dices? ¿Seguimos bailando juntos por la vida? 💃🕺"
  ];

  let indice = 0;
  let respuestaFinal = "";
  let mensajePersonal = "";

  function mostrarSiguiente() {
    const frase = document.getElementById("frase");
    const contenedorBotones = document.querySelector(".botones");
    const campoRespuesta = document.getElementById("campoRespuesta");

    if (indice < frases.length - 1) {
      escribir(frases[indice]);
      indice++;
    } else {
      escribir(frases[indice]);
      contenedorBotones.innerHTML = `
        <button onclick="responderUnica('Sí')">Sí 💃</button>
        <button onclick="responderUnica('No')">No 😅</button>
      `;
    }
  }

  function responderUnica(respuesta) {
    respuestaFinal = respuesta;

    let mensajeFinal = "";
    if (respuesta === "Sí") {
      mensajeFinal = "💌 Este poema te lo dedico desde lo más profundo de mi corazón. Porque te mereces todo lo bonito que pueda imaginar.";
    } else {
      mensajeFinal = "😔 Lamento que no quieras bailar conmigo... Pero igual, este poema va para ti, porque hasta tus 'no' me hacen sonreír 💘";
    }

    escribir(mensajeFinal);
    mostrarCampoTextoYBoton();
  }

  function mostrarCampoTextoYBoton() {
    document.querySelector(".botones").innerHTML = `
      <button onclick="irCancion()">Ver el poema 💖</button>
    `;
    document.getElementById("campoRespuesta").innerHTML = `
      <textarea id="mensajePersonal" placeholder="¿Quieres agregar algo más? 💌"></textarea>
    `;
  }

  function irCancion() {
    const textarea = document.getElementById("mensajePersonal");
    mensajePersonal = textarea ? textarea.value.trim() : "";

    const frase = document.getElementById("frase");
    frase.innerHTML = "Gracias por tu respuesta, en unos segundos leerás algo especial... 💖";

    guardarRespuestaFinal(respuestaFinal, mensajePersonal);
  }

  function guardarRespuestaFinal(respuesta, mensaje) {
    db.collection("res_dia2Si").add({
      respuesta: respuesta,
      mensaje: mensaje,
      fecha: new Date().toISOString()
    })
    .then(() => {
      console.log("Guardado en Firebase:", respuesta, mensaje);

      // Ocultar textarea y botones
      document.getElementById("campoRespuesta").innerHTML = "";
      document.querySelector(".botones").innerHTML = "";

      const poema = `
        💖 Poema para ti 💖
        En cada mirada encuentro
        un universo en tus ojos, sereno.
        Con cada sonrisa tuya florezco,
        en el jardín de lo eterno.
        No hacen falta mil palabras,
        solo un gesto tuyo y vuelo.
        Porque contigo todo brilla,
        incluso lo más pequeño.
        Así que gracias por estar aquí,
        por compartir esta historia conmigo.
        Porque si de algo estoy seguro,
        es que mi corazón... ya es tuyo 💌
      `;

      escribirPoema(poema);
    })
    .catch((error) => {
      console.error("Error al guardar en Firebase:", error);
      document.getElementById("frase").innerHTML = "Ocurrió un error al guardar tu respuesta 😔. Inténtalo de nuevo.";
    });
  }

  function escribir(texto) {
    const frase = document.getElementById("frase");
    frase.innerHTML = "";
    frase.style.fontFamily = "'Dancing Script', cursive";
    frase.style.fontSize = "1.5em";
    let i = 0;
    const intervalo = setInterval(() => {
      if (i < texto.length) {
        frase.innerHTML += texto.charAt(i);
        i++;
      } else {
        clearInterval(intervalo);
      }
    }, 35);
  }

  function escribirPoema(texto) {
    const frase = document.getElementById("frase");
    frase.innerHTML = "";
    frase.style.fontFamily = "'Quicksand', sans-serif";
    frase.style.fontSize = "1.2em";
    frase.style.whiteSpace = "pre-wrap";

    let i = 0;
    const intervalo = setInterval(() => {
      if (i < texto.length) {
        frase.innerHTML += texto.charAt(i);
        i++;
      } else {
        clearInterval(intervalo);
      }
    }, 25);
  }
</script>

</body>
</html>
