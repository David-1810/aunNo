<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nuestra Historia</title>
  <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Quicksand&display=swap" rel="stylesheet">
  <style>
    :root {
      --lila: #D7BDE2;
      --lila-oscuro: #BB8FCE;
      --texto: #4A235A;
      --fondo: #FDF3FF;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      padding: 0;
      background-color: var(--fondo);
      color: var(--texto);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
      text-align: center;
    }

    #contenedor {
      max-width: 90%;
      padding: 20px;
      background-color: white;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(187, 143, 206, 0.3);
      transition: all 0.5s ease-in-out;
    }

    #frase {
      font-size: 1.5em;
      margin-bottom: 30px;
      font-family: 'Dancing Script', cursive;
    }

    .botones {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 15px;
    }

    button {
      background-color: var(--lila);
      color: var(--texto);
      border: none;
      padding: 12px 24px;
      font-size: 1em;
      border-radius: 12px;
      cursor: pointer;
      transition: background-color 0.3s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    button:hover {
      background-color: var(--lila-oscuro);
    }

    textarea {
      margin-top: 15px;
      width: 100%;
      max-width: 400px;
      height: 80px;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid var(--lila-oscuro);
      font-family: 'Quicksand', sans-serif;
      resize: none;
    }

    .corazon {
      position: absolute;
      color: #F1948A;
      font-size: 1.5rem;
      animation: flotar 10s linear infinite;
      opacity: 0.4;
      z-index: 1;
    }

    @keyframes flotar {
      0% { transform: translateY(100vh) scale(1); opacity: 0.4; }
      100% { transform: translateY(-100vh) scale(1.5); opacity: 0; }
    }

    @media (max-width: 600px) {
      #frase { font-size: 1.3em; }
      button { font-size: 0.95em; padding: 10px 20px; }
    }
  </style>
</head>
<body>

<!-- Corazones flotantes -->
<script>
  for (let i = 0; i < 20; i++) {
    const corazon = document.createElement('div');
    corazon.className = 'corazon';
    corazon.style.left = Math.random() * 100 + 'vw';
    corazon.style.fontSize = (1 + Math.random() * 1.5) + 'rem';
    corazon.style.animationDuration = (5 + Math.random() * 10) + 's';
    corazon.innerText = 'ğŸ’–';
    document.body.appendChild(corazon);
  }
</script>

<div id="contenedor">
  <div id="frase">Toca para comenzar nuestra historia... ğŸ’–</div>
  <div id="campoRespuesta"></div>
  <div class="botones">
    <button id="btnSiguiente" onclick="mostrarSiguiente()">Siguiente</button>
  </div>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyCIsuPHYYhxQYbz5zTJZyr63xJ100shyoo",
    authDomain: "prueba-5a28c.firebaseapp.com",
    projectId: "prueba-5a28c",
    storageBucket: "prueba-5a28c.firebasestorage.app",
    messagingSenderId: "1003817153957",
    appId: "1:1003817153957:web:aa74e747452f1fe361a44c"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
</script>

<script>
  const frases = [
    "Todo empezÃ³ con un...",
    "Hola, Â¿te gustarÃ­a bailar? Para que no piensen que solo vinimos por la comidaâ€¦ ğŸ˜…",
    "Una pregunta que no sabÃ­a que cambiarÃ­a mi vida ğŸ˜",
    "Con cada charla, me fui sintiendo mÃ¡s afortunado ğŸ€",
    "Tu voz, tu risa, tu forma de serâ€¦ me fueron atrapando ğŸ’˜",
    "Y no puedo evitar pensar cuÃ¡nto significas para mÃ­ ğŸ’­",
    "Eres mi pensamiento favorito, incluso cuando intento concentrarme ğŸ˜…",
    "Si estoy sonriendo sin razÃ³n, probablemente estÃ©s tÃº en mi mente ğŸ’",
    "Desde que llegaste, todo se siente mÃ¡s bonito ğŸŒ·",
    "Hay personas que iluminan dÃ­as... tÃº iluminas hasta pensamientos ğŸŒŸ",
    "Te convertiste en mi canciÃ³n favorita sin siquiera cantar ğŸ¶",
    "Quisiera guardar cada risa tuya en mi bolsillo ğŸ«¶",
    "Me haces sentir que hasta los silencios pueden ser mÃ¡gicos ğŸŒŒ",
    "Y aquÃ­ estoy, dedicÃ¡ndote este pequeÃ±o espacio solo para ti ğŸ’–",
    "Porque cada palabra, cada gesto, cada momento contigo es un regalo ğŸ",
    "Â¿QuÃ© te parece si seguimos escribiendo nuestra historia juntos? ğŸ“–",
    "Porque cada dÃ­a contigo es una nueva pÃ¡gina llena de sorpresas y risas ğŸŒˆ",
    "Y aunque no siempre sea fÃ¡cil, sÃ© que contigo todo vale la pena â˜ºï¸",
    "AquÃ­ estoy, esperando que este pequeÃ±o gesto te haga sonreÃ­r ğŸ˜„",
    "Porque te mereces todo lo bonito que pueda imaginar ğŸ’–",
    "Y aunque no siempre encuentre las palabras perfectas, espero que sientas lo que quiero decirte ğŸ’Œ",
    "Si alguna vez te has sentido especial, es porque lo eres para mÃ­ ğŸŒŸ",
    "Â¿QuÃ© dices? Â¿Seguimos bailando juntos por la vida? ğŸ’ƒğŸ•º"
  ];

  let indice = 0;
  let respuestaFinal = "";
  let mensajePersonal = "";

  function mostrarSiguiente() {
    const frase = document.getElementById("frase");
    const contenedorBotones = document.querySelector(".botones");
    const campoRespuesta = document.getElementById("campoRespuesta");

    if (indice < frases.length - 1) {
      escribir(frases[indice]);
      indice++;
    } else {
      escribir(frases[indice]);
      contenedorBotones.innerHTML = `
        <button onclick="responderUnica('SÃ­')">SÃ­ ğŸ’ƒ</button>
        <button onclick="responderUnica('No')">No ğŸ˜…</button>
      `;
    }
  }

  function responderUnica(respuesta) {
    respuestaFinal = respuesta;

    let mensajeFinal = "";
    if (respuesta === "SÃ­") {
      mensajeFinal = "ğŸ’Œ Este poema te lo dedico desde lo mÃ¡s profundo de mi corazÃ³n. Porque te mereces todo lo bonito que pueda imaginar.";
    } else {
      mensajeFinal = "ğŸ˜” Lamento que no quieras bailar conmigo... Pero igual, este poema va para ti, porque hasta tus 'no' me hacen sonreÃ­r ğŸ’˜";
    }

    escribir(mensajeFinal);
    mostrarCampoTextoYBoton();
  }

  function mostrarCampoTextoYBoton() {
    document.querySelector(".botones").innerHTML = `
      <button onclick="irCancion()">Ver el poema ğŸ’–</button>
    `;
    document.getElementById("campoRespuesta").innerHTML = `
      <textarea id="mensajePersonal" placeholder="Â¿Quieres agregar algo mÃ¡s? ğŸ’Œ"></textarea>
    `;
  }

  function irCancion() {
    const textarea = document.getElementById("mensajePersonal");
    mensajePersonal = textarea ? textarea.value.trim() : "";

    const frase = document.getElementById("frase");
    frase.innerHTML = "Gracias por tu respuesta, en unos segundos leerÃ¡s algo especial... ğŸ’–";

    guardarRespuestaFinal(respuestaFinal, mensajePersonal);
  }

  function guardarRespuestaFinal(respuesta, mensaje) {
    db.collection("res_dia2Si").add({
      respuesta: respuesta,
      mensaje: mensaje,
      fecha: new Date().toISOString()
    })
    .then(() => {
      console.log("Guardado en Firebase:", respuesta, mensaje);

      // Ocultar textarea y botones
      document.getElementById("campoRespuesta").innerHTML = "";
      document.querySelector(".botones").innerHTML = "";

      const poema = `
        ğŸ’– Poema para ti ğŸ’–
        En cada mirada encuentro
        un universo en tus ojos, sereno.
        Con cada sonrisa tuya florezco,
        en el jardÃ­n de lo eterno.
        No hacen falta mil palabras,
        solo un gesto tuyo y vuelo.
        Porque contigo todo brilla,
        incluso lo mÃ¡s pequeÃ±o.
        AsÃ­ que gracias por estar aquÃ­,
        por compartir esta historia conmigo.
        Porque si de algo estoy seguro,
        es que mi corazÃ³n... ya es tuyo ğŸ’Œ
      `;

      escribirPoema(poema);
    })
    .catch((error) => {
      console.error("Error al guardar en Firebase:", error);
      document.getElementById("frase").innerHTML = "OcurriÃ³ un error al guardar tu respuesta ğŸ˜”. IntÃ©ntalo de nuevo.";
    });
  }

  function escribir(texto) {
    const frase = document.getElementById("frase");
    frase.innerHTML = "";
    frase.style.fontFamily = "'Dancing Script', cursive";
    frase.style.fontSize = "1.5em";
    let i = 0;
    const intervalo = setInterval(() => {
      if (i < texto.length) {
        frase.innerHTML += texto.charAt(i);
        i++;
      } else {
        clearInterval(intervalo);
      }
    }, 35);
  }

  function escribirPoema(texto) {
    const frase = document.getElementById("frase");
    frase.innerHTML = "";
    frase.style.fontFamily = "'Quicksand', sans-serif";
    frase.style.fontSize = "1.2em";
    frase.style.whiteSpace = "pre-wrap";

    let i = 0;
    const intervalo = setInterval(() => {
      if (i < texto.length) {
        frase.innerHTML += texto.charAt(i);
        i++;
      } else {
        clearInterval(intervalo);
      }
    }, 25);
  }
</script>

</body>
</html>
